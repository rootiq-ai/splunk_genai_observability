<form version="1.1" theme="dark">
  <label>Operations Center</label>
  <description>Real-time monitoring and operations dashboard for GenAI applications</description>
  <!-- Auto-refresh every 30 seconds -->
  <search id="base_search">
    <query>
      `genai_traces_index`  workflow_name=$workflow_filter$ 
      | eval is_error=if(status="ERROR" OR is_error=1, 1, 0)
    </query>
    <earliest>$time_range.earliest$</earliest>
    <latest>$time_range.latest$</latest>
  </search>
  <!-- System Health Status -->
  <!-- Real-time Trends -->
  <!-- Latency Monitoring -->
  <!-- Component Status -->
  <!-- Model Performance -->
  <!-- Workflow Health -->
  <!-- Recent Errors -->
  <!-- Token Usage -->
  <fieldset submitButton="true" autoRun="true">
    <input type="time" token="time_range" searchWhenChanged="true">
      <label>Time Range</label>
      <default>
        <earliest>-60m@m</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="workflow_filter" searchWhenChanged="true">
      <label>Workflow</label>
      <choice value="*">All Workflows</choice>
      <default>*</default>
      <search>
        <query>`genai_traces_index` | stats count by workflow_name | sort -count</query>
        <earliest>-24h</earliest>
        <latest>now</latest>
      </search>
      <fieldForLabel>workflow_name</fieldForLabel>
      <fieldForValue>workflow_name</fieldForValue>
    </input>
    <input type="dropdown" token="refresh_rate" searchWhenChanged="true">
      <label>Refresh</label>
      <choice value="30s">30 seconds</choice>
      <choice value="1m">1 minute</choice>
      <choice value="5m">5 minutes</choice>
      <choice value="0">Manual</choice>
      <default>1m</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>System Health</title>
      <single>
        <search>
          <query>index=genai_traces sourcetype="genai:trace" workflow_name=$workflow_filter$ 
| stats count as total, sum(eval(if(status="ERROR" OR is_error=1, 1, 0))) as errors 
| eval error_rate = round((errors/total)*100, 2)
| eval health = case(error_rate &gt; 10, "CRITICAL", error_rate &gt; 5, "DEGRADED", 1=1, "HEALTHY")
| eval display =  health
| table display</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[1,2]</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">0</option>
      </single>
    </panel>
    <panel>
      <title>Total Requests (Last 15m)</title>
      <single>
        <search>
          <query>`genai_traces_index`  workflow_name=$workflow_filter$ 
| stats count</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x006d9c"]</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Error Count (Last 15m)</title>
      <single>
        <search>
          <query>`genai_traces_index` workflow_name=$workflow_filter$ (status="ERROR" OR is_error=1)
| stats count</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[5,20]</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Error Rate (Last 15m)</title>
      <single>
        <search>
          <query>`genai_traces_index`  workflow_name=$workflow_filter$ 
| stats count as total, sum(eval(if(status="ERROR" OR is_error=1, 1, 0))) as errors 
| eval error_rate = if(total&gt;0, round((errors/total)*100, 2), 0)
| fields error_rate</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[2,5]</option>
        <option name="refresh.display">progressbar</option>
        <option name="unit">%</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Avg Latency (Last 15m)</title>
      <single>
        <search>
          <query>`genai_traces_index` workflow_name=$workflow_filter$ duration_ms=*
| stats avg(duration_ms) as avg_latency 
| eval avg_latency = round(avg_latency, 0)</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[2000,5000]</option>
        <option name="refresh.display">progressbar</option>
        <option name="unit">ms</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Active Workflows</title>
      <single>
        <search>
          <query>`genai_traces_index`  workflow_name=$workflow_filter$ 
| stats dc(workflow_name) as workflows</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x006d9c"]</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>Request Volume (Real-time)</title>
      <chart>
        <search>
          <query>`genai_traces_index`  workflow_name=$workflow_filter$ 
| timechart span=1m count as Requests</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <refresh>$refresh_rate$</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.text">Requests</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.legend.placement">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Error Trend (Real-time)</title>
      <chart>
        <search>
          <query>`genai_traces_index`  workflow_name=$workflow_filter$ (status="ERROR" OR is_error=1)
| timechart count as Errors</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <refresh>$refresh_rate$</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.text">Errors</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.fieldColors">{"Errors": 0xdc4e41}</option>
        <option name="charting.legend.placement">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Latency Trend (Percentiles)</title>
      <chart>
        <search>
          <query>`genai_traces_index`  workflow_name=$workflow_filter$ duration_ms=*
| timechart avg(duration_ms) as "Avg", perc50(duration_ms) as "P50", perc95(duration_ms) as "P95", perc99(duration_ms) as "P99"</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <refresh>$refresh_rate$</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.text">Latency (ms)</option>
        <option name="charting.chart">line</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Throughput by Span Type</title>
      <chart>
        <search>
          <query>`genai_traces_index`  workflow_name=$workflow_filter$ 
| timechart count by span_type</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <refresh>$refresh_rate$</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Component Health Status</title>
      <table>
        <search>
          <query>`genai_traces_index`  workflow_name=$workflow_filter$ 
| stats count as total, 
        sum(eval(if(status="ERROR" OR is_error=1, 1, 0))) as errors,
        avg(duration_ms) as avg_latency,
        perc95(duration_ms) as p95_latency
        by span_type
| eval error_rate = round((errors/total)*100, 2)
| eval avg_latency = round(avg_latency, 0)
| eval p95_latency = round(p95_latency, 0)
| eval status = case(error_rate &gt; 10, "Critical", error_rate &gt; 5, "Degraded", 1=1, "Healthy")
| table span_type, status, total, errors, error_rate, avg_latency, p95_latency
| rename span_type as "Component", status as "Status", total as "Requests", errors as "Errors", error_rate as "Error %", avg_latency as "Avg (ms)", p95_latency as "P95 (ms)"
| sort -Requests</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <refresh>$refresh_rate$</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="count">10</option>
        <option name="drilldown">row</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="Error %">
          <colorPalette type="list">[#53A051,#F8BE34,#DC4E41]</colorPalette>
          <scale type="threshold">2,5</scale>
        </format>
      </table>
    </panel>
    <panel>
      <title>LLM Model Performance</title>
      <table>
        <search>
          <query>`genai_traces_index`  workflow_name=$workflow_filter$ span_type="LLM" model_name=*
| stats count as requests,
        avg(duration_ms) as avg_latency,
        perc95(duration_ms) as p95_latency,
        sum(input_tokens) as input_tokens,
        sum(output_tokens) as output_tokens,
        sum(eval(if(status="ERROR" OR is_error=1, 1, 0))) as errors
        by model_name, model_provider
| eval error_rate = round((errors/requests)*100, 2)
| eval avg_latency = round(avg_latency, 0)
| eval p95_latency = round(p95_latency, 0)
| eval total_tokens = input_tokens + output_tokens
| eval status = case(error_rate &gt; 10, "Critical", error_rate &gt; 5, "Degraded", 1=1, "Healthy")
| table status, model_name, model_provider, requests, avg_latency, p95_latency, input_tokens, output_tokens, error_rate
| rename status as "Status", model_name as "Model", model_provider as "Provider", requests as "Requests", avg_latency as "Avg (ms)", p95_latency as "P95 (ms)", input_tokens as "Input Tokens", output_tokens as "Output Tokens", error_rate as "Error %"
| sort -Requests</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <refresh>$refresh_rate$</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="count">10</option>
        <option name="drilldown">row</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="Error %">
          <colorPalette type="list">[#53A051,#F8BE34,#DC4E41]</colorPalette>
          <scale type="threshold">2,5</scale>
        </format>
        <format type="number" field="Input Tokens">
          <option name="precision">0</option>
        </format>
        <format type="number" field="Output Tokens">
          <option name="precision">0</option>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Workflow Health</title>
      <table>
        <search>
          <query>
`genai_traces_index`  workflow_name=$workflow_filter$ 
| stats count as requests,
        avg(duration_ms) as avg_latency,
        sum(eval(if(status="ERROR" OR is_error=1, 1, 0))) as errors,
        dc(trace_id) as traces,
        latest(_time) as last_seen
        by workflow_name
| eval error_rate = round((errors/requests)*100, 2)
| eval avg_latency = round(avg_latency, 0)
| eval status = case(error_rate &gt; 10, "Critical", error_rate &gt; 5, "Degraded", 1=1, "Healthy")
| eval last_seen = strftime(last_seen, "%Y-%m-%d %H:%M:%S")
| table workflow_name, status, requests, traces, errors, error_rate, avg_latency, last_seen
| rename workflow_name as "Workflow", status as "Status", requests as "Requests", traces as "Traces", errors as "Errors", error_rate as "Error %", avg_latency as "Avg Latency (ms)", last_seen as "Last Activity"
| sort -Requests
          </query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <refresh>$refresh_rate$</refresh>
        </search>
        <option name="drilldown">row</option>
        <option name="count">20</option>
        <format type="color" field="Error %">
          <colorPalette type="list">[#53A051,#F8BE34,#DC4E41]</colorPalette>
          <scale type="threshold">2,5</scale>
        </format>
      </table>
    </panel>
    <panel>
      <title>Recent Errors</title>
      <table>
        <search>
          <query>
`genai_traces_index`  workflow_name=$workflow_filter$ (status="ERROR" OR is_error=1)
| eval time = strftime(_time, "%H:%M:%S")
| table time, workflow_name, span_type, name, model_name, error_message, duration_ms
| rename time as "Time", workflow_name as "Workflow", span_type as "Type", name as "Operation", model_name as "Model", error_message as "Error", duration_ms as "Duration (ms)"
| head 20
          </query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <refresh>$refresh_rate$</refresh>
        </search>
        <option name="drilldown">row</option>
        <option name="count">10</option>
        <format type="color" field="Type">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
    <panel>
      <title>Token Usage (Last Hour)</title>
      <chart>
        <search>
          <query>`genai_traces_index`  workflow_name=$workflow_filter$ |spath|search span_type="LLM"
| timechart span=5m sum(input_tokens) as "Input Tokens", sum(output_tokens) as "Output Tokens"</query>
          <earliest>-1h</earliest>
          <latest>now</latest>
          <refresh>$refresh_rate$</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
</form>