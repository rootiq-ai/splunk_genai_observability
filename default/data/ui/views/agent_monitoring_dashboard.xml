<form version="1.1" theme="dark">
  <label>Agent Monitoring</label>
  <description>Monitor AI agents, their actions, and performance metrics</description>
  <!-- Row 1: Key Metrics -->
  <!-- Row 2: Agent Executions Over Time -->
  <!-- Row 3: Agent Performance by Name -->
  <!-- Row 4: Agent Duration Distribution -->
  <!-- Row 5: Agent Details Table -->
  <!-- Row 6: Agent Errors -->
  <!-- Row 7: Agent Workflow Analysis -->
  <fieldset submitButton="false">
    <input type="time" token="time">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <single>
        <title>Total Agent Executions</title>
        <search>
          <query>index=genai_traces span_type="AGENT"
| stats count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x53a051","0x006d9c","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Unique Agents</title>
        <search>
          <query>index=genai_traces span_type="AGENT"
| stats dc(agent_name) as unique_agents</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x006d9c"]</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Avg Agent Duration (ms)</title>
        <search>
          <query>index=genai_traces span_type="AGENT"
| stats avg(duration_ms) as avg_duration
| eval avg_duration=round(avg_duration, 2)</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[5000,15000]</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Agent Error Rate</title>
        <search>
          <query>index=genai_traces span_type="AGENT"
| stats count(eval(is_error=1)) as errors, count as total
| eval error_rate=round((errors/total)*100, 2)
| eval error_rate=error_rate."%"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Agent Executions Over Time</title>
        <search>
          <query>index=genai_traces span_type="AGENT"
| timechart span=1h count by agent_name</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Agent Performance by Name</title>
        <search>
          <query>index=genai_traces span_type="AGENT"
| stats count as executions, avg(duration_ms) as avg_duration, count(eval(is_error=1)) as errors by agent_name
| eval avg_duration=round(avg_duration, 2)
| eval error_rate=round((errors/executions)*100, 2)
| sort -executions</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Agent Types Distribution</title>
        <search>
          <query>index=genai_traces span_type="AGENT"
| stats count by agent_type
| sort -count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Agent Duration Distribution (ms)</title>
        <search>
          <query>index=genai_traces span_type="AGENT"
| eval duration_bucket=case(
    duration_ms&lt;1000, "0-1s",
    duration_ms&lt;5000, "1-5s",
    duration_ms&lt;10000, "5-10s",
    duration_ms&lt;30000, "10-30s",
    1=1, "30s+"
)
| stats count by duration_bucket
| sort duration_bucket</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Avg Duration by Agent Type</title>
        <search>
          <query>index=genai_traces span_type="AGENT"
| stats avg(duration_ms) as avg_duration by agent_type
| eval avg_duration=round(avg_duration, 2)
| sort -avg_duration</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Agents by Workflow</title>
        <search>
          <query>index=genai_traces span_type="AGENT"
| stats count by workflow_name, agent_name
| sort -count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Recent Agent Executions</title>
        <search>
          <query>index=genai_traces span_type="AGENT"
| table timestamp, agent_name, agent_type, duration_ms, status, is_error, trace_id, workflow_name
| sort -timestamp
| head 100
| eval duration_ms=round(duration_ms, 2)
| rename timestamp as "Time", agent_name as "Agent", agent_type as "Type", duration_ms as "Duration (ms)", status as "Status", is_error as "Error", trace_id as "Trace ID", workflow_name as "Workflow"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="count">20</option>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
    <panel>
      <chart>
        <title>Agent Errors Over Time</title>
        <search>
          <query>index=genai_traces span_type="AGENT" is_error=1
| timechart span=1h count by agent_name</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <table>
        <title>Recent Agent Errors</title>
        <search>
          <query>index=genai_traces span_type="AGENT" is_error=1
| table timestamp, agent_name, agent_type, error_message, error_type, trace_id
| sort -timestamp
| head 50
| rename timestamp as "Time", agent_name as "Agent", agent_type as "Type", error_message as "Error Message", error_type as "Error Type", trace_id as "Trace ID"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
</form>